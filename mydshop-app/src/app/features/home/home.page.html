<ion-header class="ion-no-border">
  <!-- Barra de Benef√≠cios -->
  <div class="benefits-bar">
    <div class="benefit-item">
      <ion-icon name="car-outline"></ion-icon>
      <span>Frete gr√°tis acima de R$ 99</span>
    </div>
    <div class="benefit-item">
      <ion-icon name="shield-checkmark-outline"></ion-icon>
      <span>Compra r√°pida & segura</span>
    </div>
    <div class="benefit-item">
      <ion-icon name="thumbs-up-outline"></ion-icon>
      <span>Satisfa√ß√£o garantida</span>
    </div>
  </div>

  <ion-toolbar>
    <!-- Logo -->
    <ion-title slot="start">
      <span class="logo" *ngIf="!brand?.logo || logoFailed">
        <ng-container *ngFor="let part of brandParts">
          <span [class.logo-highlight]="part.highlight" [class.logo-normal]="!part.highlight">{{ part.text }}</span>
        </ng-container>
      </span>
      <img *ngIf="brand?.logo && !logoFailed" 
           [src]="brand?.logo" 
           [alt]="brand?.name || 'Logo'" 
           class="header-logo"
          
           (load)="onLogoLoad()"
           (error)="onLogoError($event)" />
    </ion-title>
    
    <!-- Bot√µes -->
    <ion-buttons slot="end">
      <ion-button routerLink="/search">
        <ion-icon slot="icon-only" name="search-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <!-- Barra de busca -->
  <ion-toolbar>
    <ion-searchbar 
      [(ngModel)]="searchQuery"
      [placeholder]="texts?.homeWelcome || 'Buscar produtos...'"
      (keyup.enter)="goToSearch()"
      animated="true"
      mode="ios">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- DEBUG MODE - Remover depois -->
  <div *ngIf="showDebug" style="background: #1a1a2e; color: #0f0; padding: 10px; font-size: 11px; font-family: monospace; max-height: 200px; overflow-y: auto; position: sticky; top: 0; z-index: 9999;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
      <strong>üêõ DEBUG MODE</strong>
      <button (click)="showDebug = false" style="background: #f00; color: #fff; border: none; padding: 2px 8px; border-radius: 3px;">X</button>
    </div>
    <div *ngFor="let msg of debugMessages" [style.color]="msg.includes('ERRO') ? '#f00' : msg.includes('OK') ? '#0f0' : '#0ff'">
      {{ msg }}
    </div>
    <div *ngIf="debugMessages.length === 0">Aguardando logs...</div>
  </div>
  
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Carregando...</p>
  </div>

  <!-- Conte√∫do -->
  <div *ngIf="!isLoading">
    
    <!-- Carrossel de Banners -->
    <div class="banner-carousel" *ngIf="banners.length > 0">
      <swiper-container 
        #swiperBanner
        pagination="true"
        pagination-clickable="true"
        autoplay-delay="4000"
        autoplay-disable-on-interaction="false"
        loop="true"
        class="banner-swiper">
        
        <swiper-slide *ngFor="let banner of banners">
          <div class="banner-slide" [style.background]="banner.gradient" (click)="onBannerClick(banner)">
            <div class="banner-content">
              <span class="banner-icon">{{ banner.icon }}</span>
              <div class="banner-text">
                <h2>{{ banner.title }}</h2>
                <p>{{ banner.subtitle }}</p>
              </div>
            </div>
            <ion-button *ngIf="banner.buttonText" fill="solid" color="light" size="small" class="banner-button">
              {{ banner.buttonText }}
              <ion-icon slot="end" name="arrow-forward"></ion-icon>
            </ion-button>
          </div>
        </swiper-slide>
        
      </swiper-container>
      
      <!-- Indicadores customizados -->
      <div class="banner-indicators">
        <span 
          *ngFor="let banner of banners; let i = index" 
          class="indicator" 
          [class.active]="currentBannerIndex === i"
          (click)="goToBanner(i)">
        </span>
      </div>
    </div>

    <!-- Categorias -->
    <section class="section categories-section">
      <div class="section-header">
        <h3>Categorias</h3>
        <ion-button fill="clear" size="small" routerLink="/tabs/categories">
          Ver todas
          <ion-icon slot="end" name="chevron-forward"></ion-icon>
        </ion-button>
      </div>
      
      <div class="categories-scroll">
        <div class="category-item" *ngFor="let category of categories" (click)="goToCategory(category)">
          <div class="category-icon">
            <img 
              *ngIf="category.image && !categoryImageErrors.has(category.id)" 
              [src]="category.image | imageUrl" 
              [alt]="category.name" 
              class="category-img"
              (error)="onCategoryImageError(category.id)"
              loading="lazy">
            <ion-icon *ngIf="!category.image || categoryImageErrors.has(category.id)" name="cube-outline"></ion-icon>
          </div>
          <span class="category-name">{{ category.name }}</span>
        </div>
      </div>
    </section>

    <!-- Produtos em Destaque -->
    <section class="section" *ngIf="featuredProducts.length > 0">
      <div class="section-header">
        <h3>üåü Destaques</h3>
        <ion-button fill="clear" size="small" (click)="viewAllFeatured()">
          Ver todos
          <ion-icon slot="end" name="chevron-forward"></ion-icon>
        </ion-button>
      </div>
      
      <div class="products-scroll">
        <div class="product-card" *ngFor="let product of featuredProducts" (click)="goToProduct(product)">
          <!-- Badge de desconto -->
          <div class="discount-badge" *ngIf="getDiscount(product.price, product.comparePrice) > 0">
            -{{ getDiscount(product.price, product.comparePrice) }}%
          </div>
          
          <!-- Imagem -->
          <div class="product-image">
            <img [src]="product.images?.[0] | imageUrl" [alt]="product.name" loading="lazy">
          </div>
          
          <!-- Info -->
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            
            <!-- Espa√ßador flex√≠vel -->
            <div class="product-spacer"></div>
            
            <!-- Pre√ßos -->
            <div class="product-price">
              <span class="compare-price">
                <ng-container *ngIf="product.comparePrice && product.comparePrice > product.price">
                  {{ formatPrice(product.comparePrice) }}
                </ng-container>
              </span>
              <span class="current-price">{{ formatPrice(product.price) }}</span>
            </div>
            
            <!-- Frete Gr√°tis ou placeholder -->
            <div class="free-shipping-badge" *ngIf="hasFreeShipping(product)">
              <ion-icon name="car-outline"></ion-icon>
              <span>{{ getFreeShippingLabel(product) }}</span>
            </div>
            <div class="shipping-placeholder" *ngIf="!hasFreeShipping(product)"></div>
            
            <!-- Bot√£o adicionar -->
            <ion-button 
              expand="block" 
              size="small" 
              (click)="addToCart(product, $event)"
              [disabled]="product.stock <= 0">
              <ion-icon slot="start" name="cart-outline"></ion-icon>
              {{ product.stock > 0 ? 'Adicionar' : 'Indispon√≠vel' }}
            </ion-button>
          </div>
        </div>
      </div>
    </section>

    <!-- Novidades -->
    <section class="section" *ngIf="newProducts.length > 0">
      <div class="section-header">
        <h3>üÜï Novidades</h3>
        <ion-button fill="clear" size="small" (click)="viewAllNew()">
          Ver todos
          <ion-icon slot="end" name="chevron-forward"></ion-icon>
        </ion-button>
      </div>
      
      <div class="products-scroll">
        <div class="product-card" *ngFor="let product of newProducts" (click)="goToProduct(product)">
          <!-- Badge de desconto -->
          <div class="discount-badge" *ngIf="getDiscount(product.price, product.comparePrice) > 0">
            -{{ getDiscount(product.price, product.comparePrice) }}%
          </div>
          
          <!-- Imagem -->
          <div class="product-image">
            <img [src]="product.images?.[0] | imageUrl" [alt]="product.name" loading="lazy">
          </div>
          
          <!-- Info -->
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            
            <!-- Espa√ßador flex√≠vel -->
            <div class="product-spacer"></div>
            
            <!-- Pre√ßos -->
            <div class="product-price">
              <span class="compare-price">
                <ng-container *ngIf="product.comparePrice && product.comparePrice > product.price">
                  {{ formatPrice(product.comparePrice) }}
                </ng-container>
              </span>
              <span class="current-price">{{ formatPrice(product.price) }}</span>
            </div>
            
            <!-- Frete Gr√°tis ou placeholder -->
            <div class="free-shipping-badge" *ngIf="hasFreeShipping(product)">
              <ion-icon name="car-outline"></ion-icon>
              <span>{{ getFreeShippingLabel(product) }}</span>
            </div>
            <div class="shipping-placeholder" *ngIf="!hasFreeShipping(product)"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- üåü SPOTLIGHT - Produto em Destaque com Detalhes -->
    <section class="section spotlight-section" *ngIf="spotlightProduct">
      <div class="section-header">
        <h3>üéØ Produto do Momento</h3>
      </div>
      
      <div class="spotlight-card" (click)="goToProduct(spotlightProduct)">
        <div class="spotlight-image">
          <img [src]="spotlightProduct.images?.[0] | imageUrl" [alt]="spotlightProduct.name" loading="lazy">
          <div class="spotlight-discount-badge" *ngIf="getDiscount(spotlightProduct.price, spotlightProduct.comparePrice) > 0">
            -{{ getDiscount(spotlightProduct.price, spotlightProduct.comparePrice) }}% OFF
          </div>
        </div>
        
        <div class="spotlight-content">
          <h2 class="spotlight-name">{{ spotlightProduct.name }}</h2>
          
          <!-- Avalia√ß√µes -->
          <div class="spotlight-rating" *ngIf="spotlightRating.total > 0">
            <div class="stars">
              <ion-icon *ngFor="let star of getStarsArray(spotlightRating.average)" [name]="star" color="warning"></ion-icon>
            </div>
            <span class="rating-text">{{ spotlightRating.average.toFixed(1) }} ({{ spotlightRating.total }} avalia√ß√µes)</span>
          </div>
          <div class="spotlight-rating" *ngIf="spotlightRating.total === 0">
            <span class="rating-text" style="color: #999;">Seja o primeiro a avaliar!</span>
          </div>
          
          <!-- Pre√ßo -->
          <div class="spotlight-price">
            <span class="compare-price" *ngIf="spotlightProduct.comparePrice && spotlightProduct.comparePrice > spotlightProduct.price">
              De: {{ formatPrice(spotlightProduct.comparePrice) }}
            </span>
            <span class="current-price">{{ formatPrice(spotlightProduct.price) }}</span>
            <span class="installment">ou 12x de {{ formatPrice(spotlightProduct.price / 12) }}</span>
          </div>
          
          <!-- Frete -->
          <div class="spotlight-shipping">
            <ion-icon name="car-outline"></ion-icon>
            <span class="shipping-info">
              <span class="shipping-cost" [class.free]="spotlightProduct.price >= 199">
                {{ getEstimatedShipping(spotlightProduct) }}
              </span>
              <span class="shipping-time">Entrega: {{ getEstimatedDelivery() }}</span>
            </span>
          </div>
          
          <!-- Bot√£o -->
          <ion-button expand="block" (click)="addToCart(spotlightProduct, $event)" [disabled]="spotlightProduct.stock <= 0">
            <ion-icon slot="start" name="cart-outline"></ion-icon>
            {{ spotlightProduct.stock > 0 ? 'Comprar Agora' : 'Indispon√≠vel' }}
          </ion-button>
        </div>
      </div>
    </section>

    <!-- üïê VISTOS RECENTEMENTE -->
    <section class="section recently-viewed-section" *ngIf="recentlyViewed.length > 0">
      <div class="section-header">
        <h3>üïê Vistos Recentemente</h3>
        <ion-button fill="clear" size="small" (click)="recentlyViewedService.clear(); recentlyViewed = [];">
          Limpar
          <ion-icon slot="end" name="trash-outline"></ion-icon>
        </ion-button>
      </div>
      
      <div class="products-scroll">
        <div class="product-card" *ngFor="let product of recentlyViewed" (click)="goToProduct(product)">
          <div class="discount-badge" *ngIf="getDiscount(product.price, product.comparePrice) > 0">
            -{{ getDiscount(product.price, product.comparePrice) }}%
          </div>
          
          <div class="product-image">
            <img [src]="product.images?.[0] | imageUrl" [alt]="product.name" loading="lazy">
          </div>
          
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            
            <!-- Espa√ßador flex√≠vel -->
            <div class="product-spacer"></div>
            
            <!-- Pre√ßos -->
            <div class="product-price">
              <span class="compare-price">
                <ng-container *ngIf="product.comparePrice && product.comparePrice > product.price">
                  {{ formatPrice(product.comparePrice) }}
                </ng-container>
              </span>
              <span class="current-price">{{ formatPrice(product.price) }}</span>
            </div>
            
            <!-- Frete Gr√°tis ou placeholder -->
            <div class="free-shipping-badge" *ngIf="hasFreeShipping(product)">
              <ion-icon name="car-outline"></ion-icon>
              <span>{{ getFreeShippingLabel(product) }}</span>
            </div>
            <div class="shipping-placeholder" *ngIf="!hasFreeShipping(product)"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- üîÄ SE√á√ïES DIN√ÇMICAS ALEAT√ìRIAS -->
    <section class="section dynamic-section" *ngFor="let section of dynamicSections">
      <div class="section-header">
        <h3>{{ section.title }}</h3>
      </div>
      
      <div class="products-scroll">
        <div class="product-card" *ngFor="let product of section.products" (click)="goToProduct(product)">
          <div class="discount-badge" *ngIf="getDiscount(product.price, product.comparePrice) > 0">
            -{{ getDiscount(product.price, product.comparePrice) }}%
          </div>
          
          <div class="product-image">
            <img [src]="product.images?.[0] | imageUrl" [alt]="product.name" loading="lazy">
          </div>
          
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            
            <!-- Espa√ßador flex√≠vel -->
            <div class="product-spacer"></div>
            
            <!-- Pre√ßos -->
            <div class="product-price">
              <span class="compare-price">
                <ng-container *ngIf="product.comparePrice && product.comparePrice > product.price">
                  {{ formatPrice(product.comparePrice) }}
                </ng-container>
              </span>
              <span class="current-price">{{ formatPrice(product.price) }}</span>
            </div>
            
            <!-- Frete Gr√°tis ou placeholder -->
            <div class="free-shipping-badge" *ngIf="hasFreeShipping(product)">
              <ion-icon name="car-outline"></ion-icon>
              <span>{{ getFreeShippingLabel(product) }}</span>
            </div>
            <div class="shipping-placeholder" *ngIf="!hasFreeShipping(product)"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Todos os Produtos (Infinite Scroll) -->
    <section class="section all-products-section">
      <div class="section-header">
        <h3>üì¶ Todos os Produtos</h3>
      </div>
      
      <!-- Mensagem quando n√£o h√° produtos -->
      <div *ngIf="!isLoading && allProducts.length === 0" class="empty-state">
        <ion-icon name="bag-outline" style="font-size: 64px; color: #ccc; margin-bottom: 16px;"></ion-icon>
        <h4 style="color: #666; margin: 0;">Nenhum produto dispon√≠vel</h4>
        <p style="color: #999; font-size: 14px;">Em breve teremos novidades!</p>
      </div>
      
      <div class="products-grid" *ngIf="allProducts.length > 0">
        <div class="product-card-grid" *ngFor="let product of allProducts" (click)="goToProduct(product)">
          <!-- Badge de desconto -->
          <div class="discount-badge" *ngIf="getDiscount(product.price, product.comparePrice) > 0">
            -{{ getDiscount(product.price, product.comparePrice) }}%
          </div>
          
          <!-- Imagem -->
          <div class="product-image">
            <img [src]="product.images?.[0] | imageUrl" [alt]="product.name" loading="lazy">
          </div>
          
          <!-- Info -->
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            
            <!-- Espa√ßador flex√≠vel -->
            <div class="product-spacer"></div>
            
            <!-- Pre√ßos -->
            <div class="product-price">
              <span class="compare-price">
                <ng-container *ngIf="product.comparePrice && product.comparePrice > product.price">
                  {{ formatPrice(product.comparePrice) }}
                </ng-container>
              </span>
              <span class="current-price">{{ formatPrice(product.price) }}</span>
            </div>
            
            <!-- Frete Gr√°tis ou placeholder -->
            <div class="free-shipping-badge" *ngIf="hasFreeShipping(product)">
              <ion-icon name="car-outline"></ion-icon>
              <span>{{ getFreeShippingLabel(product) }}</span>
            </div>
            <div class="shipping-placeholder" *ngIf="!hasFreeShipping(product)"></div>
          </div>
        </div>
      </div>
      
      <!-- Fecha div products-grid quando tem produtos -->

      <!-- Loading indicator -->
      <div class="loading-more" *ngIf="isLoadingMore">
        <ion-spinner name="dots" color="primary"></ion-spinner>
        <span>Carregando mais produtos...</span>
      </div>
    </section>

  </div>

  <!-- Infinite Scroll -->
  <ion-infinite-scroll 
    threshold="200px" 
    (ionInfinite)="loadMoreProducts($event)"
    [disabled]="!hasMoreProducts">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Carregando mais produtos...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

</ion-content>
