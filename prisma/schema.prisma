generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextIndex", "fullTextSearch"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(cuid())
  name             String?
  email            String            @unique
  emailVerified    DateTime?
  image            String?
  password         String?
  phone            String?
  cpf              String?
  role             Role              @default(USER)
  workForSellerId  String?
  employeeRole     EmployeeRole?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  blockedAt        DateTime?
  blockedReason    String?           @db.VarChar(255)
  isActive         Boolean           @default(true)
  addresses        Address[]
  affiliate        Affiliate?
  aliexpressAuth   AliExpressAuth?
  cartItems        CartItem[]
  cashback         CustomerCashback?
  developerApps    DeveloperApp[]    @relation("DeveloperApps")
  oauthCodes           OAuthCode[]           @relation("UserOAuthCodes")
  oauthConnections     OAuthConnection[]     @relation("UserOAuthConnections")
  shopifyInstallations ShopifyInstallation[] @relation("UserShopifyInstallations")
  mercadoLivreAuth     MercadoLivreAuth?
  orders           Order[]
  productQuestions ProductQuestion[]
  productReviews   ProductReview[]
  returnRequests   ReturnRequest[]
  reviewHelpfuls   ReviewHelpful[]
  seller           Seller?           @relation("SellerOwner")
  shopeeAuth       ShopeeAuth?
  tiktokShopAuth   TikTokShopAuth?
  workForSeller    Seller?           @relation("SellerEmployees", fields: [workForSellerId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([workForSellerId])
  @@index([role])
  @@index([email, role])
  @@index([createdAt])
  @@map("user")
}

model Address {
  id            String   @id @default(cuid())
  userId        String
  label         String?
  recipientName String?
  street        String
  complement    String?
  neighborhood  String?
  city          String
  state         String
  zipCode       String
  phone         String?
  cpf           String?
  reference     String?  @db.VarChar(255)
  notes         String?  @db.Text
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isDefault])
  @@map("address")
}

model Seller {
  id                     String                        @id @default(cuid())
  userId                 String                        @unique
  storeName              String
  storeSlug              String                        @unique
  storeDescription       String?                       @db.Text
  storeLogo              String?
  storeBanner            String?
  sellerType             SellerType
  cpf                    String?
  rg                     String?
  dataNascimento         DateTime?
  cnpj                   String?
  razaoSocial            String?
  nomeFantasia           String?
  inscricaoEstadual      String?
  cep                    String?
  endereco               String?
  numero                 String?
  complemento            String?
  bairro                 String?
  cidade                 String?
  estado                 String?
  banco                  String?
  agencia                String?
  conta                  String?
  tipoConta              String?
  chavePix               String?
  commission             Float                         @default(10)
  status                 SellerStatus                  @default(PENDING)
  createdAt              DateTime                      @default(now())
  updatedAt              DateTime                      @updatedAt
  balance                Float                         @default(0)
  nomeCompleto           String?
  totalEarned            Float                         @default(0)
  totalWithdrawn         Float                         @default(0)
  orders                 Order[]                       @relation("SellerOrders")
  ordersSold             Order[]                       @relation("SellerSoldOrders")
  products               Product[]
  user                   User                          @relation("SellerOwner", fields: [userId], references: [id], onDelete: Cascade)
  account                SellerAccount?
  marketplaceCredentials SellerMarketplaceCredential[]
  subscriptions          Subscription[]
  employees              User[]                        @relation("SellerEmployees")
  withdrawals            Withdrawal[]

  @@index([status])
  @@index([storeSlug])
  @@index([userId])
  @@map("seller")
}

model SellerMarketplaceCredential {
  id                 String    @id @default(cuid())
  sellerId           String
  marketplace        String
  mlClientId         String?
  mlClientSecret     String?
  mlAccessToken      String?   @db.Text
  mlRefreshToken     String?   @db.Text
  mlUserId           String?
  mlExpiresAt        DateTime?
  aliAppKey          String?
  aliAppSecret       String?
  aliTrackingId      String?
  aliAccessToken     String?   @db.Text
  shopeePartnerId    Int?
  shopeePartnerKey   String?
  shopeeAccessToken  String?   @db.Text
  shopeeRefreshToken String?   @db.Text
  shopeeShopId       Int?
  shopeeMerchantName String?
  shopeeRegion       String?
  shopeeExpiresAt    DateTime?
  isActive           Boolean   @default(true)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  seller             Seller    @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@unique([sellerId, marketplace])
  @@index([sellerId])
  @@map("sellermarketplacecredential")
}

model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  image       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  parentId    String?
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]

  @@index([parentId])
  @@map("category")
}

model Product {
  id                       String               @id @default(cuid())
  name                     String
  slug                     String               @unique
  description              String?              @db.Text
  price                    Float
  comparePrice             Float?
  costPrice                Float?
  shippingCost             Float?
  taxCost                  Float?
  totalCost                Float?
  margin                   Float?
  isDropshipping           Boolean              @default(false)
  dropshippingCommission   Float?
  images                   String               @db.Text
  stock                    Int                  @default(0)
  featured                 Boolean              @default(false)
  categoryId               String
  sellerId                 String?
  supplierId               String?
  supplierSku              String?
  supplierUrl              String?              @db.Text
  specifications           String?              @db.Text
  variants                 String?              @db.Text
  attributes               String?              @db.Text
  gtin                     String?
  brand                    String?
  model                    String?
  color                    String?
  mpn                      String?
  technicalSpecs           String?              @db.Text
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  availableForDropship     Boolean              @default(true)
  isChoiceProduct          Boolean              @default(false)
  lastSyncAt               DateTime?
  supplierRating           Float?
  supplierShippingSpeed    Float?
  supplierStock            Int?
  supplierStoreId          String?
  supplierStoreName        String?
  active                   Boolean              @default(true)
  bookAuthor               String?
  bookGenre                String?
  bookIsbn                 String?
  bookPublisher            String?
  bookTitle                String?
  selectedSkus             String?              @db.Text
  sizes                    String?              @db.Text
  sizeType                 String?
  sizeCategory             String?
  acceptsCreditCard        Boolean?
  aliquotaCofins           Float?               @map("aliquota_cofins")
  aliquotaIcms             Float?               @map("aliquota_icms")
  aliquotaPis              Float?               @map("aliquota_pis")
  approvalNote             String?              @db.Text
  approvalStatus           String               @default("APPROVED")
  approvedAt               DateTime?
  approvedBy               String?
  cest                     String?
  cfopInterestadual        String?              @map("cfop_interestadual")
  cfopInterno              String?              @map("cfop_interno")
  cstCofins                String?              @map("cst_cofins")
  cstIcms                  String?              @map("cst_icms")
  cstPis                   String?              @map("cst_pis")
  deliveryDays             Int?
  height                   Float?
  heightWithPackage        Float?
  installmentsFreeInterest Int?
  length                   Float?
  lengthWithPackage        Float?
  maxInstallments          Int?
  ncm                      String?
  origem                   String?              @default("0")
  reducaoBcIcms            Float?               @map("reducao_bc_icms")
  shipFromCountry          String?
  supplierCountryCode      String?
  tributacaoEspecial       String?              @default("normal") @map("tributacao_especial")
  unidadeComercial         String?              @default("UN") @map("unidade_comercial")
  unidadeTributavel        String?              @default("UN") @map("unidade_tributavel")
  weight                   Float?
  weightWithPackage        Float?
  width                    Float?
  widthWithPackage         Float?
  warehouseCode            String?              @db.VarChar(100)
  cartItems                CartItem[]
  marketplaceListings      MarketplaceListing[]
  orderItems               OrderItem[]
  category                 Category             @relation(fields: [categoryId], references: [id])
  seller                   Seller?              @relation(fields: [sellerId], references: [id])
  supplier                 Supplier?            @relation(fields: [supplierId], references: [id])
  questions                ProductQuestion[]
  reviews                  ProductReview[]
  socialPosts              SocialPost[]

  @@index([categoryId])
  @@index([sellerId])
  @@index([supplierId])
  @@index([featured])
  @@index([isDropshipping])
  @@index([active])
  @@index([approvalStatus])
  @@index([categoryId, featured])
  @@index([categoryId, active])
  @@index([sellerId, active])
  @@index([sellerId, approvalStatus])
  @@index([isDropshipping, availableForDropship])
  @@index([createdAt])
  @@index([warehouseCode], map: "idx_product_warehouse")
  @@map("product")
}

model Supplier {
  id         String    @id @default(cuid())
  name       String
  email      String    @unique
  phone      String?
  website    String?
  apiUrl     String?
  apiKey     String?
  type       String    @default("aliexpress") @db.VarChar(255)
  isActive   Boolean   @default(true)
  commission Float     @default(0)
  active     Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  products   Product[]

  @@map("supplier")
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@map("cartitem")
}

model CartNotification {
  id           String   @id @default(cuid())
  userId       String
  type         String   @db.VarChar(50)
  sentAt       DateTime @default(now()) @db.DateTime(0)
  emailSent    Boolean  @default(true)
  whatsappSent Boolean  @default(false)

  @@index([sentAt], map: "idx_sent_at")
  @@index([userId, type], map: "idx_user_type")
  @@map("cart_notification")
}

model Order {
  id                         String          @id @default(cuid())
  userId                     String?
  status                     OrderStatus     @default(PENDING)
  total                      Float
  profit                     Float?
  shippingAddress            String          @db.Text
  paymentIntentId            String?
  supplierOrderId            String?
  trackingCode               String?
  marketplaceName            String?
  marketplaceOrderId         String?         @unique
  sentToSupplier             Boolean         @default(false)
  sentToSupplierAt           DateTime?
  createdAt                  DateTime        @default(now())
  updatedAt                  DateTime        @updatedAt
  buyerEmail                 String?
  buyerName                  String?
  buyerPhone                 String?
  buyerCpf                   String?
  paymentMethod              String?
  shippingCost               Float?
  buyerMessages              String?         @db.Text
  cancelReason               String?
  commissionAmount           Float?
  commissionRate             Float?
  sellerRevenue              Float?
  soldBySellerId             String?
  sellerId                   String?
  paymentApprovedAt          DateTime?
  paymentDetails             String?         @db.LongText
  paymentId                  String?
  paymentStatus              String?
  paymentType                String?
  parentOrderId              String?
  correiosIdPrePostagem      String?
  deliveryDays               Int?
  expeditionNotes            String?         @db.Text
  labelPrintedAt             DateTime?
  packagingBoxId             String?
  packedAt                   DateTime?
  packedBy                   String?
  separatedAt                DateTime?
  separatedBy                String?
  shippedAt                  DateTime?
  shippedBy                  String?
  shippingCarrier            String?
  shippingLabel              String?         @db.Text
  shippingLabelType          String?
  shippingMethod             String?
  shippingService            String?
  fraudScore                 Int?
  fraudReasons               String?         @db.Text
  fraudStatus                String?         @db.VarChar(50)
  fraudCheckedAt             DateTime?       @db.DateTime(0)
  fraudCheckedBy             String?         @db.VarChar(255)
  fraudNotes                 String?         @db.Text
  ipAddress                  String?         @db.VarChar(100)
  userAgent                  String?         @db.Text
  importTax                  Float?
  icmsTax                    Float?
  deliveredAt                DateTime?
  deliveredBy                String?
  receiverName               String?
  receiverDocument           String?
  deliveryNotes              String?         @db.Text
  deliveryPhoto              String?         @db.Text
  deliveryAttempts           Int?            @default(0)
  affiliateId                String?
  affiliateCode              String?
  couponCode                 String?
  discountAmount             Float?
  subtotal                   Float?
  awaitingShipmentNotifiedAt DateTime?       @db.DateTime(0)
  deliveryNotifiedAt         DateTime?       @db.DateTime(0)
  notificationsSent          String?         @db.LongText
  warehouseCode              String?         @db.VarChar(100)
  affiliateSale              AffiliateSale?
  invoices                   Invoice[]
  seller                     Seller?         @relation("SellerOrders", fields: [sellerId], references: [id])
  soldBySeller               Seller?         @relation("SellerSoldOrders", fields: [soldBySellerId], references: [id])
  user                       User?           @relation(fields: [userId], references: [id])
  items                      OrderItem[]
  productReviews             ProductReview[]
  refunds                    Refund[]
  returnRequests             ReturnRequest[]

  @@index([userId])
  @@index([sellerId])
  @@index([soldBySellerId])
  @@index([status])
  @@index([createdAt])
  @@index([sellerId, status])
  @@index([userId, status])
  @@index([marketplaceOrderId])
  @@index([parentOrderId])
  @@index([packagingBoxId])
  @@index([shippingMethod])
  @@index([affiliateId])
  @@index([fraudScore], map: "idx_fraud_score")
  @@index([fraudStatus], map: "idx_fraud_status")
  @@index([correiosIdPrePostagem], map: "idx_correios_prepostagem")
  @@index([warehouseCode], map: "idx_warehouse_code")
  @@index([awaitingShipmentNotifiedAt], map: "idx_awaiting_shipment_notified")
  @@index([deliveryNotifiedAt], map: "idx_delivery_notified")
  @@map("order")
}

model OrderItem {
  id               String       @id @default(cuid())
  orderId          String
  productId        String
  quantity         Int
  price            Float
  createdAt        DateTime     @default(now())
  commissionAmount Float?
  commissionRate   Float?
  sellerId         String?
  sellerRevenue    Float?
  costPrice        Float?
  itemType         ItemType     @default(STOCK)
  refundedAt       DateTime?
  selectedColor    String?
  selectedSize     String?
  supplierCost     Float?
  supplierOrderId  String?
  supplierSkuId    String?
  supplierStatus   String?
  trackingCode     String?
  order            Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product      @relation(fields: [productId], references: [id])
  refundItems      RefundItem[]

  @@index([orderId])
  @@index([productId])
  @@index([itemType])
  @@index([sellerId])
  @@map("orderitem")
}

model MercadoLivreAuth {
  id           String   @id @default(cuid())
  userId       String   @unique
  accessToken  String   @db.Text
  refreshToken String   @db.Text
  expiresAt    DateTime
  mlUserId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("mercadolivreauth")
}

model AliExpressAuth {
  id           String    @id @default(cuid())
  userId       String    @unique
  appKey       String
  appSecret    String    @db.Text
  accessToken  String?   @db.Text
  refreshToken String?   @db.Text
  expiresAt    DateTime?
  trackingId   String?
  sellerId     String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("aliexpressauth")
}

model ShopeeAuth {
  id           String   @id @default(cuid())
  userId       String   @unique
  partnerId    Int
  partnerKey   String
  accessToken  String   @db.Text
  refreshToken String   @db.Text
  shopId       Int
  merchantName String?
  region       String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("shopeeauth")
}

model TikTokShopAuth {
  id                   String    @id @default(cuid())
  userId               String    @unique
  appKey               String
  appSecret            String    @db.Text
  accessToken          String?   @db.Text
  refreshToken         String?   @db.Text
  accessTokenExpireIn  Int?
  refreshTokenExpireIn Int?
  shopId               String?
  shopName             String?
  shopCipher           String?   @db.Text
  openId               String?
  sellerName           String?
  region               String?   @default("BR")
  expiresAt            DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("tiktokshopauth")
}

model MarketplaceListing {
  id           String    @id @default(cuid())
  productId    String
  marketplace  String
  listingId    String
  status       String
  title        String?
  price        Float?
  stock        Int?
  listingUrl   String?   @db.Text
  lastSyncAt   DateTime?
  syncEnabled  Boolean   @default(true)
  errorMessage String?   @db.Text
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  product      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, marketplace])
  @@index([marketplace])
  @@index([status])
  @@map("marketplacelisting")
}

model CompanySettings {
  id                            String   @id @default(cuid())
  name                          String?
  cnpj                          String?
  email                         String?
  phone                         String?
  address                       String?  @db.Text
  defaultCommission             Float?   @default(10)
  processingDays                Int?     @default(2)
  showRealTimeStock             Boolean  @default(true)
  autoApproveSellers            Boolean  @default(false)
  notifyNewDropshippingProducts Boolean  @default(true)
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime @updatedAt
  city                          String?  @db.VarChar(100)
  state                         String?  @db.VarChar(2)
  zipCode                       String?  @db.VarChar(10)

  @@map("company_settings")
}

model CompanyBranch {
  id                    String    @id @default(cuid()) @db.VarChar(36)
  code                  String    @unique @db.VarChar(100)
  name                  String    @db.VarChar(255)
  cnpj                  String    @db.VarChar(18)
  ie                    String?   @db.VarChar(20)
  im                    String?   @db.VarChar(20)
  street                String    @db.VarChar(255)
  number                String    @db.VarChar(20)
  complement            String?   @db.VarChar(100)
  neighborhood          String    @db.VarChar(100)
  city                  String    @db.VarChar(100)
  cityCode              String?   @db.VarChar(7)
  state                 String    @db.Char(2)
  zipCode               String    @db.VarChar(9)
  phone                 String?   @db.VarChar(20)
  email                 String?   @db.VarChar(100)
  statesServed          String?   @db.LongText
  isDefault             Boolean   @default(false)
  isActive              Boolean   @default(true)
  nfSerie               String?   @db.VarChar(10)
  nfAmbiente            String?   @db.VarChar(20)
  nfNaturezaOperacao    String?   @db.VarChar(255)
  nfCrt                 String?   @db.VarChar(2)
  nfCertificadoArquivo  String?   @db.VarChar(500)
  nfCertificadoSenha    String?   @db.Text
  nfCertificadoValidade DateTime? @db.DateTime(0)
  nfTaxRulesJson        String?   @db.LongText
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @default(now()) @updatedAt

  @@index([isActive], map: "idx_branch_active")
  @@index([state], map: "idx_branch_state")
  @@map("company_branch")
}

model MercadoLivreCredentials {
  id           String   @id @default(cuid())
  clientId     String
  clientSecret String   @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("mercadolivrecredentials")
}

model Plan {
  id                        String         @id @default(cuid())
  name                      String
  description               String?        @db.Text
  price                     Float
  billingCycle              BillingCycle
  maxProducts               Int?
  maxOrders                 Int?
  maxRevenue                Float?
  hasMarketplaceIntegration Boolean        @default(false)
  hasDropshipping           Boolean        @default(false)
  hasAdvancedAnalytics      Boolean        @default(false)
  hasCustomBranding         Boolean        @default(false)
  hasPrioritySupport        Boolean        @default(false)
  platformCommission        Float          @default(10)
  isActive                  Boolean        @default(true)
  isPopular                 Boolean        @default(false)
  hasFreeTrial              Boolean        @default(false)
  trialDays                 Int?
  createdAt                 DateTime       @default(now())
  updatedAt                 DateTime       @updatedAt
  subscriptions             Subscription[]

  @@map("plan")
}

model Subscription {
  id              String             @id @default(cuid())
  sellerId        String
  planId          String
  status          SubscriptionStatus @default(TRIAL)
  startDate       DateTime           @default(now())
  endDate         DateTime
  trialEndDate    DateTime?
  cancelledAt     DateTime?
  price           Float
  billingCycle    BillingCycle
  nextBillingDate DateTime?
  autoRenew       Boolean            @default(true)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  contractNumber  String?
  invoiceUrl      String?
  notes           String?            @db.Text
  paymentId       String?
  previousId      String?
  renewedToId     String?
  plan            Plan               @relation(fields: [planId], references: [id])
  seller          Seller             @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([status])
  @@index([endDate])
  @@index([nextBillingDate])
  @@index([planId], map: "subscription_planId_fkey")
  @@map("subscription")
}

model ProductType {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  icon        String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("product_type")
}

model PaymentGateway {
  id        String   @id @default(cuid())
  gateway   String   @unique
  isActive  Boolean  @default(false)
  config    String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payment_gateway")
}

model Refund {
  id          String       @id @default(cuid())
  orderId     String
  paymentId   String
  refundId    String?
  amount      Float
  reason      String?      @db.Text
  gateway     String
  status      String
  processedBy String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  order       Order        @relation(fields: [orderId], references: [id])
  items       RefundItem[]

  @@index([orderId])
  @@index([paymentId])
  @@map("refund")
}

model RefundItem {
  id          String    @id @default(cuid())
  refundId    String
  orderItemId String
  amount      Float
  createdAt   DateTime  @default(now())
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id])
  refund      Refund    @relation(fields: [refundId], references: [id])

  @@index([refundId])
  @@index([orderItemId])
  @@map("refund_item")
}

model Withdrawal {
  id              String           @id @default(cuid())
  sellerId        String
  amount          Float
  status          WithdrawalStatus @default(PENDING)
  paymentMethod   String
  pixKey          String?
  pixKeyType      String?
  bankName        String?
  bankCode        String?
  agencia         String?
  conta           String?
  contaTipo       String?
  transactionId   String?
  processedAt     DateTime?
  processedBy     String?
  rejectionReason String?          @db.Text
  sellerNote      String?          @db.Text
  adminNote       String?          @db.Text
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  seller          Seller           @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([status])
  @@index([createdAt])
  @@map("withdrawal")
}

model ApiLog {
  id           String   @id @default(cuid())
  method       String
  endpoint     String
  statusCode   Int
  userId       String?
  userRole     String?
  sellerId     String?
  sellerName   String?
  requestBody  String?  @db.Text
  responseBody String?  @db.Text
  errorMessage String?  @db.Text
  ipAddress    String?
  userAgent    String?  @db.Text
  duration     Int?
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([sellerId])
  @@index([method])
  @@index([endpoint])
  @@index([statusCode])
  @@index([createdAt])
  @@map("api_log")
}

model SyncLog {
  id         String   @id @default(cuid())
  type       String
  totalItems Int      @default(0)
  synced     Int      @default(0)
  errors     Int      @default(0)
  details    String?  @db.LongText
  duration   Int      @default(0)
  createdAt  DateTime @default(now())

  @@index([type])
  @@index([createdAt])
  @@map("sync_log")
}

model prisma_migrations_itemtype {
  value String @id

  @@map("_prisma_migrations_itemtype")
}

model ShippingRule {
  id              String   @id @default(cuid())
  name            String
  description     String?
  regionType      String
  regions         String   @db.Text
  minWeight       Float?
  maxWeight       Float?
  shippingCost    Float
  costPerKg       Float?
  freeShippingMin Float?
  deliveryDays    Int
  isActive        Boolean  @default(true)
  priority        Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  minCartValue    Float?
  maxCartValue    Float?

  @@index([isActive])
  @@index([regionType])
  @@index([priority])
  @@map("shippingrule")
}

model PackagingBox {
  id          String        @id @default(cuid())
  name        String
  code        String        @unique
  type        PackagingType @default(BOX)
  innerLength Float
  innerWidth  Float
  innerHeight Float
  outerLength Float
  outerWidth  Float
  outerHeight Float
  emptyWeight Float
  maxWeight   Float
  maxVolume   Float?
  cost        Float         @default(0)
  isActive    Boolean       @default(true)
  isDefault   Boolean       @default(false)
  priority    Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([isActive])
  @@index([type])
  @@index([priority])
  @@map("packagingbox")
}

model ShippingCarrier {
  id           String              @id @default(cuid())
  code         String              @unique
  name         String
  type         ShippingCarrierType @default(CARRIER)
  logo         String?
  color        String?
  isActive     Boolean             @default(true)
  isDefault    Boolean             @default(false)
  apiUrl       String?
  apiKey       String?
  apiSecret    String?
  apiToken     String?             @db.Text
  apiConfig    String?             @db.Text
  contractCode String?
  adminCode    String?
  username     String?
  password     String?
  senderCNPJ   String?
  senderCEP    String?
  labelFormat  String?             @default("PDF")
  labelWidth   Float?
  labelHeight  Float?
  trackingUrl  String?
  priority     Int                 @default(0)
  minWeight    Float?
  maxWeight    Float?
  maxLength    Float?
  maxWidth     Float?
  maxHeight    Float?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  services     ShippingService[]

  @@index([isActive])
  @@index([code])
  @@map("shippingcarrier")
}

model ShippingService {
  id             String          @id @default(cuid())
  carrierId      String
  code           String
  name           String
  description    String?
  minDays        Int?
  maxDays        Int?
  additionalDays Int?            @default(0)
  baseCost       Float?
  costPerKg      Float?
  percentageFee  Float?
  isActive       Boolean         @default(true)
  maxWeight      Float?
  maxValue       Float?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  carrier        ShippingCarrier @relation(fields: [carrierId], references: [id], onDelete: Cascade)

  @@unique([carrierId, code])
  @@index([carrierId])
  @@index([isActive])
  @@map("shippingservice")
}

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  category    String
  label       String
  description String?  @db.Text
  type        String   @default("text")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([key])
  @@map("systemconfig")
}

model analytics_table {
  id          String   @id
  name        String
  description String?  @db.Text
  data        String   @db.LongText
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([createdAt])
  @@index([name])
}

model Invoice {
  id                       String        @id @default(cuid())
  orderId                  String
  invoiceNumber            String?       @unique
  accessKey                String?       @unique
  series                   String?
  type                     InvoiceType
  status                   InvoiceStatus @default(PENDING)
  issuedBy                 String?
  issuedAt                 DateTime?
  cancelledAt              DateTime?
  cancelReason             String?       @db.Text
  xmlUrl                   String?
  pdfUrl                   String?
  danfeUrl                 String?
  cfop                     String?
  naturezaOperacao         String?
  emitenteCnpj             String?
  emitenteNome             String?
  emitenteIE               String?       @db.VarChar(20)
  emitenteCRT              String?       @db.VarChar(2)
  emitenteLogradouro       String?       @db.VarChar(255)
  emitenteNumero           String?       @db.VarChar(60)
  emitenteComplemento      String?       @db.VarChar(60)
  emitenteBairro           String?       @db.VarChar(60)
  emitenteMunicipio        String?       @db.VarChar(60)
  emitenteMunicipioCod     String?       @db.VarChar(7)
  emitenteUF               String?       @db.VarChar(2)
  emitenteCEP              String?       @db.VarChar(8)
  destinatarioCpf          String?
  destinatarioCnpj         String?
  destinatarioNome         String?
  destinatarioLogradouro   String?       @db.VarChar(255)
  destinatarioNumero       String?       @db.VarChar(60)
  destinatarioComplemento  String?       @db.VarChar(60)
  destinatarioBairro       String?       @db.VarChar(60)
  destinatarioMunicipio    String?       @db.VarChar(60)
  destinatarioMunicipioCod String?       @db.VarChar(7)
  destinatarioUF           String?       @db.VarChar(2)
  destinatarioCEP          String?       @db.VarChar(8)
  valorTotal               Float
  valorProdutos            Float
  valorFrete               Float?
  valorDesconto            Float?
  valorIcms                Float?
  valorIpi                 Float?
  valorPis                 Float?
  valorCofins              Float?
  xmlAssinado              String?       @db.LongText
  protocol                 String?
  externalId               String?
  externalProvider         String?
  errorMessage             String?       @db.Text
  metadata                 String?       @db.LongText
  createdAt                DateTime      @default(now())
  updatedAt                DateTime      @updatedAt
  order                    Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
  @@index([type])
  @@index([issuedAt])
  @@index([createdAt])
  @@index([invoiceNumber])
  @@index([accessKey])
  @@map("invoice")
}

model ReturnRequest {
  id          String    @id @default(cuid()) @db.VarChar(255)
  orderId     String    @db.VarChar(255)
  userId      String    @db.VarChar(255)
  itemIds     String    @db.LongText
  reason      String    @db.VarChar(255)
  description String?   @db.Text
  status      String    @default("PENDING") @db.VarChar(50)
  adminNotes  String?   @db.Text
  requestedAt DateTime  @default(now())
  reviewedAt  DateTime?
  reviewedBy  String?   @db.VarChar(255)
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  order       Order     @relation(fields: [orderId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([requestedAt])
  @@map("return_request")
}

model eancode {
  id        String       @id
  sellerId  String
  code      String       @unique(map: "code") @db.VarChar(13)
  type      eancode_type @default(INTERNAL)
  productId String?
  used      Boolean      @default(false)
  createdAt DateTime     @default(now())
  usedAt    DateTime?

  @@index([code], map: "EANCode_code_idx")
  @@index([productId], map: "EANCode_productId_idx")
  @@index([sellerId], map: "EANCode_sellerId_idx")
}

model eancredit {
  id         String         @id
  sellerId   String
  quantity   Int
  used       Int            @default(0)
  type       eancredit_type @default(INTERNAL)
  purchaseId String?
  expiresAt  DateTime?
  createdAt  DateTime       @default(now())

  @@index([sellerId], map: "EANCredit_sellerId_idx")
}

model eanpackage {
  id           String          @id @db.VarChar(36)
  name         String          @db.VarChar(100)
  description  String?         @db.Text
  quantity     Int
  price        Decimal         @default(0.00) @db.Decimal(10, 2)
  type         eanpackage_type
  planId       String?         @db.VarChar(36)
  active       Boolean?        @default(true)
  displayOrder Int?            @default(0)
  popular      Boolean?        @default(false)
  createdAt    DateTime        @db.DateTime(0)
  updatedAt    DateTime?       @db.DateTime(0)

  @@index([active], map: "idx_active")
  @@index([planId], map: "idx_plan")
}

model eanpurchase {
  id        String             @id
  sellerId  String
  packageId String
  quantity  Int
  type      eanpurchase_type
  price     Decimal            @db.Decimal(10, 2)
  status    eanpurchase_status @default(PENDING)
  paymentId String?
  paidAt    DateTime?
  createdAt DateTime           @default(now())

  @@index([sellerId], map: "EANPurchase_sellerId_idx")
  @@index([status], map: "EANPurchase_status_idx")
}

model invoice_event {
  id          String             @id @db.VarChar(255)
  invoice_id  String             @db.VarChar(255)
  type        invoice_event_type
  description String?            @db.Text
  protocol    String?            @db.VarChar(50)
  seq_evento  Int?               @default(1)
  xml_url     String?            @db.VarChar(500)
  xml_content String?            @db.LongText
  created_at  DateTime?          @default(now()) @db.DateTime(0)
  created_by  String?            @db.VarChar(255)

  @@index([created_at], map: "idx_invoice_event_created_at")
  @@index([invoice_id], map: "idx_invoice_event_invoice_id")
  @@index([type], map: "idx_invoice_event_type")
}

model cities {
  id       Int    @id @default(autoincrement())
  name     String @db.VarChar(100)
  stateId  Int
  ibgeCode Int    @unique(map: "uk_ibge")
  states   states @relation(fields: [stateId], references: [id], onUpdate: Restrict, map: "fk_city_state")

  @@index([name], map: "idx_name")
  @@index([stateId], map: "idx_state")
}

model states {
  id       Int      @id @default(autoincrement())
  name     String   @db.VarChar(50)
  uf       String   @unique(map: "uk_uf") @db.Char(2)
  ibgeCode Int      @unique(map: "uk_ibge")
  cities   cities[]
}

model ProductReview {
  id            String          @id @default(cuid())
  productId     String
  userId        String
  orderId       String?
  rating        Int
  title         String?         @db.VarChar(200)
  comment       String?         @db.Text
  pros          String?         @db.Text
  cons          String?         @db.Text
  images        String?         @db.Text
  isVerified    Boolean         @default(false)
  isApproved    Boolean         @default(false)
  isReported    Boolean         @default(false)
  helpfulCount  Int             @default(0)
  reportCount   Int             @default(0)
  sellerReply   String?         @db.Text
  sellerReplyAt DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  order         Order?          @relation(fields: [orderId], references: [id])
  product       Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  helpfulVotes  ReviewHelpful[]

  @@unique([productId, userId, orderId])
  @@index([productId])
  @@index([userId])
  @@index([orderId])
  @@index([rating])
  @@index([isApproved])
  @@index([createdAt])
  @@map("product_review")
}

model ProductQuestion {
  id          String    @id @default(cuid())
  productId   String
  userId      String
  question    String    @db.Text
  answer      String?   @db.Text
  answeredBy  String?
  answeredAt  DateTime?
  isPublic    Boolean   @default(true)
  isApproved  Boolean   @default(false)
  isReported  Boolean   @default(false)
  reportCount Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
  @@index([isApproved])
  @@index([answeredAt])
  @@index([createdAt])
  @@map("product_question")
}

model ReviewHelpful {
  id        String        @id @default(cuid())
  reviewId  String
  userId    String
  isHelpful Boolean       @default(true)
  createdAt DateTime      @default(now())
  review    ProductReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reviewId, userId])
  @@index([reviewId])
  @@index([userId])
  @@map("review_helpful")
}

model Coupon {
  id                String        @id @default(cuid())
  code              String        @unique
  description       String?
  discountType      DiscountType  @default(PERCENTAGE)
  discountValue     Float
  minOrderValue     Float?
  maxDiscountValue  Float?
  maxUses           Int?
  maxUsesPerUser    Int?          @default(1)
  usageCount        Int           @default(0)
  validFrom         DateTime      @default(now())
  validUntil        DateTime?
  isActive          Boolean       @default(true)
  allowedStates     String?       @db.Text
  allowedCategories String?       @db.Text
  excludedProducts  String?       @db.Text
  firstPurchaseOnly Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  createdBy         String?
  usages            CouponUsage[]

  @@index([code])
  @@index([isActive])
  @@index([validFrom, validUntil])
  @@map("coupon")
}

model CouponUsage {
  id        String   @id @default(cuid())
  couponId  String
  orderId   String
  userId    String?
  discount  Float
  createdAt DateTime @default(now())
  coupon    Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([userId])
  @@index([orderId])
  @@map("coupon_usage")
}

model SellerAccount {
  id                  String                     @id @default(cuid())
  sellerId            String?                    @unique
  affiliateId         String?                    @unique
  accountNumber       String                     @unique
  accountType         String                     @default("SELLER")
  status              SellerAccountStatus        @default(PENDING)
  balance             Float                      @default(0)
  blockedBalance      Float                      @default(0)
  totalReceived       Float                      @default(0)
  totalWithdrawn      Float                      @default(0)
  pixKeyType          String?
  pixKey              String?
  bankCode            String?
  bankName            String?
  agencia             String?
  conta               String?
  contaTipo           String?
  autoWithdrawal      Boolean                    @default(false)
  autoWithdrawalDay   Int?
  minWithdrawalAmount Float                      @default(50)
  verifiedAt          DateTime?
  verifiedBy          String?
  kycStatus           KYCStatus                  @default(PENDING)
  kycDocuments        String?                    @db.Text
  transactionPin      String?
  transactionPinSalt  String?
  lastPinChange       DateTime?
  failedPinAttempts   Int                        @default(0)
  lockedUntil         DateTime?
  metadata            String?                    @db.Text
  createdAt           DateTime                   @default(now())
  updatedAt           DateTime                   @updatedAt
  affiliate           Affiliate?                 @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  seller              Seller?                    @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  transactions        SellerAccountTransaction[]

  @@index([sellerId])
  @@index([affiliateId])
  @@index([status])
  @@index([accountNumber])
  @@index([accountType])
  @@map("seller_account")
}

model SellerAccountTransaction {
  id            String                @id @default(cuid())
  accountId     String
  type          SellerTransactionType
  amount        Float
  balanceBefore Float
  balanceAfter  Float
  description   String
  reference     String?
  referenceType String?
  orderId       String?
  withdrawalId  String?
  status        TransactionStatus     @default(COMPLETED)
  metadata      String?               @db.Text
  createdAt     DateTime              @default(now())
  processedAt   DateTime?
  processedBy   String?
  account       SellerAccount         @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([orderId])
  @@index([withdrawalId])
  @@map("seller_account_transaction")
}

model CashbackRule {
  id                String       @id @default(cuid())
  name              String
  description       String?      @db.Text
  type              CashbackType @default(PERCENTAGE)
  value             Float
  minOrderValue     Float?
  maxCashback       Float?
  categoryIds       String?      @db.Text
  productIds        String?      @db.Text
  sellerIds         String?      @db.Text
  excludedProducts  String?      @db.Text
  validFrom         DateTime     @default(now())
  validUntil        DateTime?
  isActive          Boolean      @default(true)
  priority          Int          @default(0)
  firstPurchaseOnly Boolean      @default(false)
  forNewCustomers   Boolean      @default(false)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  createdBy         String?

  @@index([isActive])
  @@index([validFrom, validUntil])
  @@index([priority])
  @@map("cashback_rule")
}

model CustomerCashback {
  id             String                @id @default(cuid())
  userId         String                @unique
  balance        Float                 @default(0)
  pendingBalance Float                 @default(0)
  totalEarned    Float                 @default(0)
  totalUsed      Float                 @default(0)
  expirationDays Int                   @default(90)
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  transactions   CashbackTransaction[]
  user           User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("customer_cashback")
}

model CashbackTransaction {
  id            String                    @id @default(cuid())
  cashbackId    String
  type          CashbackTransactionType
  amount        Float
  balanceBefore Float
  balanceAfter  Float
  description   String
  orderId       String?
  ruleId        String?
  expiresAt     DateTime?
  status        CashbackTransactionStatus @default(PENDING)
  availableAt   DateTime?
  releasedAt    DateTime?
  createdAt     DateTime                  @default(now())
  processedAt   DateTime?
  cashback      CustomerCashback          @relation(fields: [cashbackId], references: [id], onDelete: Cascade)

  @@index([cashbackId])
  @@index([orderId])
  @@index([status])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("cashback_transaction")
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String
  action     String
  resource   String?
  resourceId String?
  ipAddress  String?
  userAgent  String?  @db.Text
  status     String
  details    String?  @db.Text
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([status])
  @@index([createdAt])
  @@index([userId, action, createdAt])
  @@map("audit_log")
}

model TransactionToken {
  id          String   @id @default(cuid())
  accountId   String
  token       String   @unique
  amount      Decimal  @db.Decimal(10, 2)
  destination String
  used        Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())

  @@index([token])
  @@index([accountId])
  @@index([expiresAt])
  @@map("transaction_token")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_token")
}

model Affiliate {
  id               String                @id @default(cuid())
  userId           String                @unique
  code             String                @unique
  name             String
  email            String                @unique
  phone            String?
  cpf              String?
  instagram        String?
  youtube          String?
  tiktok           String?
  otherSocial      String?               @db.Text
  commissionRate   Float                 @default(5)
  status           AffiliateStatus       @default(PENDING)
  isActive         Boolean               @default(true)
  totalSales       Float                 @default(0)
  totalCommission  Float                 @default(0)
  availableBalance Float                 @default(0)
  totalWithdrawn   Float                 @default(0)
  banco            String?
  agencia          String?
  conta            String?
  tipoConta        String?
  chavePix         String?
  cookieDays       Int                   @default(30)
  notes            String?               @db.Text
  approvedAt       DateTime?
  approvedBy       String?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  user             User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  clicks           AffiliateClick[]
  sales            AffiliateSale[]
  withdrawals      AffiliateWithdrawal[]
  account          SellerAccount?

  @@index([code])
  @@index([status])
  @@index([userId])
  @@index([isActive])
  @@map("affiliate")
}

model AffiliateSale {
  id               String              @id @default(cuid())
  affiliateId      String
  orderId          String              @unique
  customerId       String?
  customerName     String?
  customerEmail    String?
  orderTotal       Float
  commissionRate   Float
  commissionAmount Float
  status           AffiliateSaleStatus @default(PENDING)
  availableAt      DateTime?
  paidAt           DateTime?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  affiliate        Affiliate           @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  order            Order               @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([orderId])
  @@index([status])
  @@index([createdAt])
  @@map("affiliate_sale")
}

model AffiliateWithdrawal {
  id              String           @id @default(cuid())
  affiliateId     String
  amount          Float
  status          WithdrawalStatus
  method          String
  pixKey          String?
  bankInfo        String?          @db.Text
  notes           String?          @db.Text
  proofUrl        String?
  requestedAt     DateTime         @default(now())
  processedAt     DateTime?
  processedBy     String?
  rejectedAt      DateTime?
  rejectionReason String?          @db.Text
  affiliate       Affiliate        @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([status])
  @@index([requestedAt])
  @@map("affiliate_withdrawal")
}

model AffiliateClick {
  id          String    @id @default(cuid())
  affiliateId String
  ipAddress   String?
  userAgent   String?   @db.Text
  referrer    String?   @db.Text
  landingPage String?   @db.Text
  converted   Boolean   @default(false)
  convertedAt DateTime?
  orderId     String?
  createdAt   DateTime  @default(now())
  affiliate   Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([createdAt])
  @@index([converted])
  @@map("affiliate_click")
}

model SocialConnection {
  id           String         @id @default(cuid())
  platform     SocialPlatform
  name         String         @db.VarChar(255)
  platformId   String         @db.VarChar(255)
  accessToken  String         @db.Text
  refreshToken String?        @db.Text
  expiresAt    DateTime?
  isActive     Boolean        @default(true)
  metadata     String?        @db.LongText
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  posts        SocialPost[]

  @@unique([platform, platformId])
  @@index([platform])
  @@index([isActive])
  @@map("social_connection")
}

model SocialPost {
  id             String           @id @default(cuid())
  connectionId   String
  productId      String?
  platform       SocialPlatform
  status         PostStatus       @default(DRAFT)
  caption        String           @db.Text
  images         String           @db.LongText
  scheduledFor   DateTime?
  publishedAt    DateTime?
  platformPostId String?          @db.VarChar(255)
  platformUrl    String?          @db.VarChar(500)
  stats          String?          @db.LongText
  errorMessage   String?          @db.Text
  createdBy      String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  connection     SocialConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)
  product        Product?         @relation(fields: [productId], references: [id])

  @@index([connectionId])
  @@index([productId])
  @@index([platform])
  @@index([status])
  @@index([scheduledFor])
  @@index([createdAt])
  @@map("social_post")
}

model DeveloperApp {
  id           String             @id @default(cuid())
  name         String             @db.VarChar(255)
  description  String?            @db.Text
  logoUrl      String?            @db.VarChar(500)
  websiteUrl   String?            @db.VarChar(500)
  redirectUris String             @db.LongText
  status       DevAppStatus       @default(ACTIVE)
  ownerId      String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  filterConfig String?            @db.LongText
  apiLogs      DevApiLog[]
  apiKeys      DeveloperApiKey[]
  owner        User               @relation("DeveloperApps", fields: [ownerId], references: [id], onDelete: Cascade)
  webhooks     DeveloperWebhook[]

  @@index([ownerId])
  @@index([status])
  @@map("developer_app")
}

model DeveloperApiKey {
  id           String       @id @default(cuid())
  appId        String
  keyPrefix    String       @db.VarChar(20)
  apiKey       String       @unique
  apiSecret    String       @db.Text
  scopes       String       @db.LongText
  name         String?      @db.VarChar(100)
  isActive     Boolean      @default(true)
  lastUsedAt   DateTime?
  expiresAt    DateTime?
  requestCount Int          @default(0)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  app          DeveloperApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([isActive])
  @@map("developer_api_key")
}

model DeveloperWebhook {
  id            String       @id @default(cuid())
  appId         String
  url           String       @db.VarChar(500)
  events        String       @db.LongText
  secret        String
  isActive      Boolean      @default(true)
  lastTriggered DateTime?
  failCount     Int          @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  app           DeveloperApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([isActive])
  @@map("developer_webhook")
}

model DevApiLog {
  id           String       @id @default(cuid())
  appId        String
  keyPrefix    String       @db.VarChar(20)
  method       String       @db.VarChar(10)
  path         String       @db.VarChar(255)
  statusCode   Int
  latencyMs    Int
  ipAddress    String?      @db.VarChar(100)
  userAgent    String?      @db.Text
  requestBody  String?      @db.LongText
  responseBody String?      @db.LongText
  error        String?      @db.Text
  createdAt    DateTime     @default(now())
  app          DeveloperApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([path])
  @@index([statusCode])
  @@index([createdAt])
  @@map("dev_api_log")
}

enum EmployeeRole {
  MANAGER
  OPERATOR
  VIEWER

  @@map("user_employeeRole")
}

enum Role {
  USER
  ADMIN
  SELLER

  @@map("user_role")
}

enum SellerType {
  PF
  PJ

  @@map("seller_sellerType")
}

enum SellerStatus {
  PENDING
  ACTIVE
  SUSPENDED
  REJECTED

  @@map("seller_status")
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED

  @@map("order_status")
}

enum ItemType {
  DROPSHIPPING
  STOCK

  @@map("orderitem_itemType")
}

enum BillingCycle {
  MONTHLY
  QUARTERLY
  SEMIANNUAL
  ANNUAL
}

enum SubscriptionStatus {
  PENDING_PAYMENT
  TRIAL
  ACTIVE
  EXPIRED
  CANCELLED
  SUSPENDED
}

enum WithdrawalStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  REJECTED
  CANCELLED

  @@map("withdrawal_status")
}

enum ShippingCarrierType {
  OWN
  CARRIER
  POSTAL
  AGGREGATOR
}

enum PackagingType {
  BOX
  ENVELOPE
  TUBE
  BAG
  CUSTOM
}

enum InvoiceStatus {
  PENDING
  PROCESSING
  ISSUED
  CANCELLED
  ERROR

  @@map("invoice_status")
}

enum InvoiceType {
  ADMIN
  SELLER

  @@map("invoice_type")
}

enum eancode_type {
  OFFICIAL
  INTERNAL
}

enum eancredit_type {
  OFFICIAL
  INTERNAL
}

enum eanpurchase_type {
  OFFICIAL
  INTERNAL
}

enum eanpackage_type {
  OFFICIAL
  INTERNAL
}

enum eanpurchase_status {
  PENDING
  PAID
  CANCELLED
}

enum invoice_event_type {
  EMISSAO
  AUTORIZACAO
  CANCELAMENTO
  CCE
  INUTILIZACAO
  CONSULTA
  ERRO
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum SellerAccountStatus {
  PENDING
  ACTIVE
  BLOCKED
  SUSPENDED
  CLOSED
}

enum KYCStatus {
  PENDING
  SUBMITTED
  REVIEWING
  APPROVED
  REJECTED
  NEEDS_UPDATE
}

enum SellerTransactionType {
  SALE
  WITHDRAWAL
  REFUND
  COMMISSION
  BONUS
  ADJUSTMENT_CREDIT
  ADJUSTMENT_DEBIT
  CHARGEBACK
  FEE
  TRANSFER_IN
  TRANSFER_OUT
  MIGRATION
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum CashbackType {
  PERCENTAGE
  FIXED
}

enum CashbackTransactionType {
  CREDIT
  DEBIT
  EXPIRED
  ADJUSTMENT_CREDIT
  ADJUSTMENT_DEBIT
  REFUND
}

enum CashbackTransactionStatus {
  PENDING
  AVAILABLE
  USED
  EXPIRED
  CANCELLED
}

enum AffiliateStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum AffiliateSaleStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}

enum SocialPlatform {
  FACEBOOK
  INSTAGRAM
  TIKTOK
  TWITTER
  PINTEREST
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHING
  PUBLISHED
  FAILED
}

enum DevAppStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

//  OAuth 2.0 
// Apps externos (Shopify, Amazon, etc.) que conectam seus vendedores via OAuth

model OAuthApp {
  id           String            @id @default(cuid())
  name         String            @db.VarChar(255)
  description  String?           @db.Text
  logoUrl      String?           @db.VarChar(500)
  clientId     String            @unique @db.VarChar(100)
  clientSecret String            @db.VarChar(255)
  redirectUris String            @db.LongText   // JSON array de URIs permitidas
  scopes       String            @db.LongText   // JSON array de scopes permitidos
  appType      String            @default("EXTERNAL") @db.VarChar(50) // SHOPIFY, AMAZON, CUSTOM
  status       String            @default("ACTIVE") @db.VarChar(20)
  createdBy    String?           // userId do admin que criou
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  authCodes    OAuthCode[]
  connections  OAuthConnection[]

  @@index([clientId])
  @@index([status])
  @@map("oauth_app")
}

model OAuthCode {
  id          String    @id @default(cuid())
  code        String    @unique @db.VarChar(128)
  appId       String
  userId      String    // vendedor Mydshop que autorizou
  scopes      String    @db.LongText  // JSON array de scopes aprovados
  redirectUri String    @db.VarChar(500)
  expiresAt   DateTime
  used        Boolean   @default(false)
  createdAt   DateTime  @default(now())
  app         OAuthApp  @relation(fields: [appId], references: [id], onDelete: Cascade)
  user        User      @relation("UserOAuthCodes", fields: [userId], references: [id], onDelete: Cascade)
}

model OAuthConnection {
  id           String    @id @default(cuid())
  appId        String
  userId       String    // vendedor Mydshop conectado
  accessToken  String    @unique @db.VarChar(512)
  refreshToken String?   @unique @db.VarChar(512)
  scopes       String    @db.LongText  // JSON array de scopes ativos
  expiresAt    DateTime?
  revokedAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  app          OAuthApp  @relation(fields: [appId], references: [id], onDelete: Cascade)
  user         User      @relation("UserOAuthConnections", fields: [userId], references: [id], onDelete: Cascade)
}

// =====================================================
// Shopify Partners App Integration
// =====================================================

model ShopifyInstallation {
  id                   String               @id @default(cuid())
  shopDomain           String               @unique
  accessToken          String               @db.VarChar(500)
  scope                String               @db.VarChar(1000)
  userId               String?
  shopName             String?
  shopEmail            String?
  shopPlan             String?
  shopCurrency         String?              @default("BRL")
  shopTimezone         String?
  isActive             Boolean              @default(true)
  installedAt          DateTime             @default(now())
  uninstalledAt        DateTime?
  lastSyncAt           DateTime?
  syncOrdersEnabled    Boolean              @default(true)
  syncProductsEnabled  Boolean              @default(true)
  webhookSecret        String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  user                 User?                @relation("UserShopifyInstallations", fields: [userId], references: [id], onDelete: SetNull)
  orderSyncs           ShopifyOrderSync[]
  productSyncs         ShopifyProductSync[]

  @@index([userId])
  @@index([isActive])
  @@map("shopify_installation")
}

model ShopifyOrderSync {
  id                  String              @id @default(cuid())
  installationId      String
  shopifyOrderId      String
  shopifyOrderNumber  String?
  mydOrderId          String?
  status              ShopifySyncStatus   @default(pending)
  errorMessage        String?             @db.Text
  syncedAt            DateTime?
  createdAt           DateTime            @default(now())
  installation        ShopifyInstallation @relation(fields: [installationId], references: [id], onDelete: Cascade)

  @@unique([installationId, shopifyOrderId])
  @@index([mydOrderId])
  @@map("shopify_order_sync")
}

model ShopifyProductSync {
  id                String              @id @default(cuid())
  installationId    String
  mydProductId      String
  shopifyProductId  String?
  shopifyVariantId  String?
  status            ShopifySyncStatus   @default(pending)
  errorMessage      String?             @db.Text
  syncedAt          DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  installation      ShopifyInstallation @relation(fields: [installationId], references: [id], onDelete: Cascade)

  @@unique([installationId, mydProductId])
  @@index([shopifyProductId])
  @@map("shopify_product_sync")
}

enum ShopifySyncStatus {
  pending
  synced
  failed
  skipped
}

model HelpArticle {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  category    String   @db.VarChar(100)
  description String?  @db.Text
  blocks      String   @db.LongText
  published   Boolean  @default(false)
  position    Int      @default(0)
  icon        String?  @db.VarChar(10)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([published])
  @@map("help_articles")
}
